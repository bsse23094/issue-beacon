<!-- Repository Stats Visualization -->
<section class="relative py-8 sm:py-12 md:py-16 overflow-hidden animate-fade-in">
  <div class="max-w-7xl mx-auto px-3 sm:px-4 md:px-6 lg:px-8">
    <!-- Page Header -->
    <div class="text-center mb-8 sm:mb-12">
      <h2 class="text-2xl sm:text-3xl md:text-4xl lg:text-5xl font-extrabold mb-3 sm:mb-4 text-heading text-glow-purple animate-slide-up">
        Repository Analytics
      </h2>
      <p class="text-sm sm:text-base md:text-lg lg:text-xl max-w-2xl mx-auto text-purple-400/80 text-subheading px-4">
        Deep dive into repository statistics, languages, and contributors
      </p>
    </div>

    <!-- Search Card -->
    <div class="max-w-4xl mx-auto beacon-card neon-glow-purple p-4 sm:p-6 md:p-8 animate-slide-up mb-8" style="animation-delay: 0.1s">
      <div class="space-y-4">
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div>
            <label class="block text-xs sm:text-sm font-semibold mb-2" style="color: rgb(var(--text-primary))">Owner</label>
            <input [(ngModel)]="owner" (keyup.enter)="loadStats()" placeholder="e.g., facebook"
                   class="input-premium w-full text-sm sm:text-base font-mono" style="color: rgb(var(--text-primary))"/>
          </div>
          <div>
            <label class="block text-xs sm:text-sm font-semibold mb-2" style="color: rgb(var(--text-primary))">Repository</label>
            <input [(ngModel)]="repo" (keyup.enter)="loadStats()" placeholder="e.g., react"
                   class="input-premium w-full text-sm sm:text-base font-mono" style="color: rgb(var(--text-primary))"/>
          </div>
        </div>
        <button (click)="loadStats()" 
                class="w-full px-6 py-3 text-base sm:text-lg font-bold rounded-lg neon-glow-purple hover-neon-purple bg-purple-500/20 hover:bg-purple-500/30 text-purple-400 border border-purple-500/50 transition-all duration-300">
          <span class="flex items-center justify-center gap-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
            </svg>
            Analyze Repository
          </span>
        </button>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="flex flex-col items-center justify-center py-20">
      <div class="spinner mb-6" style="width: 64px; height: 64px; border-width: 4px"></div>
      <p class="text-xl font-semibold text-heading">Loading repository stats...</p>
    </div>

    <!-- Error State -->
  <div *ngIf="error" class="beacon-card glass-alert glass-alert--danger mb-8 p-6">
      <p class="text-red-400 font-semibold">{{ error }}</p>
    </div>

    <!-- Stats Dashboard -->
    <div *ngIf="!loading && !error && repoData" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3 sm:gap-4 mb-8">
      <div class="beacon-card neon-glow-cyan hover-neon-cyan animate-slide-up p-3 sm:p-4" style="animation-delay: 0.1s">
        <div class="text-[10px] sm:text-xs font-semibold mb-1 sm:mb-2 text-cyan-400 text-subheading truncate">STARS</div>
        <div class="text-xl sm:text-2xl md:text-3xl font-black mb-1 text-heading">{{ stats.stars.toLocaleString() }}</div>
        <div class="h-0.5 sm:h-1 rounded-full mt-2 bg-cyan-400"></div>
      </div>

      <div class="beacon-card neon-glow-green hover-neon-green animate-slide-up p-3 sm:p-4" style="animation-delay: 0.15s">
        <div class="text-[10px] sm:text-xs font-semibold mb-1 sm:mb-2 text-green-400 text-subheading truncate">FORKS</div>
        <div class="text-xl sm:text-2xl md:text-3xl font-black mb-1 text-heading">{{ stats.forks.toLocaleString() }}</div>
        <div class="h-0.5 sm:h-1 rounded-full mt-2 bg-green-400"></div>
      </div>

      <div class="beacon-card neon-glow-blue hover-neon-blue animate-slide-up p-3 sm:p-4" style="animation-delay: 0.2s">
        <div class="text-[10px] sm:text-xs font-semibold mb-1 sm:mb-2 text-blue-400 text-subheading truncate">WATCHERS</div>
        <div class="text-xl sm:text-2xl md:text-3xl font-black mb-1 text-heading">{{ stats.watchers.toLocaleString() }}</div>
        <div class="h-0.5 sm:h-1 rounded-full mt-2 bg-blue-400"></div>
      </div>

      <div class="beacon-card neon-glow-purple hover-neon-purple animate-slide-up p-3 sm:p-4" style="animation-delay: 0.25s">
        <div class="text-[10px] sm:text-xs font-semibold mb-1 sm:mb-2 text-purple-400 text-subheading truncate">ISSUES</div>
        <div class="text-xl sm:text-2xl md:text-3xl font-black mb-1 text-heading">{{ stats.openIssues.toLocaleString() }}</div>
        <div class="h-0.5 sm:h-1 rounded-full mt-2 bg-purple-400"></div>
      </div>

      <div class="beacon-card neon-glow-orange hover-neon-orange animate-slide-up p-3 sm:p-4" style="animation-delay: 0.3s">
        <div class="text-[10px] sm:text-xs font-semibold mb-1 sm:mb-2 text-orange-400 text-subheading truncate">SIZE</div>
        <div class="text-xl sm:text-2xl md:text-3xl font-black mb-1 text-heading">{{ formatBytes(stats.size * 1024) }}</div>
        <div class="h-0.5 sm:h-1 rounded-full mt-2 bg-orange-400"></div>
      </div>

      <div class="beacon-card neon-glow-red hover-neon-red animate-slide-up p-3 sm:p-4" style="animation-delay: 0.35s">
        <div class="text-[10px] sm:text-xs font-semibold mb-1 sm:mb-2 text-red-400 text-subheading truncate">CONTRIBUTORS</div>
        <div class="text-xl sm:text-2xl md:text-3xl font-black mb-1 text-heading">{{ stats.contributors }}</div>
        <div class="h-0.5 sm:h-1 rounded-full mt-2 bg-red-400"></div>
      </div>
    </div>

    <!-- Charts Grid -->
    <div *ngIf="!loading && !error && repoData" class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
      <!-- Language Distribution -->
      <div class="beacon-card neon-glow-cyan p-4 sm:p-6 animate-slide-up" style="animation-delay: 0.2s">
        <h3 class="text-lg sm:text-xl font-bold mb-4 text-heading">Language Distribution</h3>
        <canvas #languageChart class="w-full h-48 sm:h-64 mb-4"></canvas>
        <div class="space-y-2">
          <div *ngFor="let lang of getLanguageEntries(); let i = index" class="flex items-center justify-between text-xs sm:text-sm">
            <span class="font-mono text-mono">{{ lang.key }}</span>
            <span class="font-bold text-heading">{{ getLanguagePercentage(lang.value) }}%</span>
          </div>
        </div>
      </div>

      <!-- Top Contributors -->
      <div class="beacon-card neon-glow-purple p-4 sm:p-6 animate-slide-up" style="animation-delay: 0.3s">
        <h3 class="text-lg sm:text-xl font-bold mb-4 text-heading">Top Contributors</h3>
        <canvas #contributorsChart class="w-full h-48 sm:h-64 mb-4"></canvas>
        <div class="space-y-3">
          <div *ngFor="let contributor of contributors.slice(0, 5)" class="flex items-center justify-between">
            <div class="flex items-center gap-2">
              <img [src]="contributor.avatar_url" [alt]="contributor.login" class="w-6 h-6 sm:w-8 sm:h-8 rounded-full"/>
              <span class="text-xs sm:text-sm font-mono text-mono">{{ contributor.login }}</span>
            </div>
            <span class="text-xs sm:text-sm font-bold text-heading">{{ contributor.contributions }} commits</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Repository Info Card -->
    <div *ngIf="!loading && !error && repoData" class="beacon-card neon-glow-blue p-4 sm:p-6 animate-slide-up" style="animation-delay: 0.4s">
      <div class="flex flex-col sm:flex-row items-start justify-between gap-4 mb-4">
        <div class="flex-1">
          <h3 class="text-xl sm:text-2xl font-bold text-heading mb-2">{{ repoData.full_name }}</h3>
          <p class="text-sm sm:text-base text-mono mb-4">{{ repoData.description }}</p>
          <div class="flex flex-wrap gap-2">
            <span *ngFor="let topic of repoData.topics" class="badge-premium text-xs">{{ topic }}</span>
          </div>
        </div>
        <button (click)="openRepo()" 
                class="px-4 sm:px-6 py-2 sm:py-3 rounded-lg font-semibold text-sm sm:text-base transition-all duration-300 hover:scale-105 bg-blue-500/20 hover:bg-blue-500/30 text-blue-400 border-2 border-blue-500">
          View on GitHub
        </button>
      </div>
      <div class="grid grid-cols-2 sm:grid-cols-4 gap-4 text-xs sm:text-sm">
        <div>
          <span class="text-mono opacity-60">Created:</span>
          <p class="font-bold text-heading">{{ repoData.created_at | date:'shortDate' }}</p>
        </div>
        <div>
          <span class="text-mono opacity-60">Updated:</span>
          <p class="font-bold text-heading">{{ repoData.updated_at | date:'shortDate' }}</p>
        </div>
        <div>
          <span class="text-mono opacity-60">License:</span>
          <p class="font-bold text-heading">{{ repoData.license?.name || 'None' }}</p>
        </div>
        <div>
          <span class="text-mono opacity-60">Default Branch:</span>
          <p class="font-bold text-heading">{{ repoData.default_branch }}</p>
        </div>
      </div>
    </div>
  </div>
</section>
